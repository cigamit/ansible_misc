{% for c in events.json.results %}{% if c.event == "runner_on_ok" and c.changed %}
{% if c.event_data.res.diff.before_header is defined %}
<tr><td>{{c.host_name}}</td><td>{{ c.playbook }}</td><td>{{ c.task }}</td><td>{{ c.event_data.resolved_action }}</td><td><pre>{{ lookup('diff', before=c.event_data.res.diff.before, after=c.event_data.res.diff.after) | default("") | to_nice_yaml(width=1337) | replace ("\\n", "\n        ") }}</pre></td></tr>
{% else %}
<tr><td>{{c.host_name}}</td><td>{{ c.playbook }}</td><td>{{ c.task }}</td><td>{{ c.event_data.resolved_action }}</td><td><pre>{{ c.event_data.res.diff | default("") | to_nice_yaml(width=1337) | replace ("\\n", "\n        ") }}</pre></td></tr>
{% endif %}

{% endif %}{% endfor %}
